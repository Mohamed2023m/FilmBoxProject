@page "/review/create"
@using FilmBox.App.ViewModel
@using FilmBox.App.Services
@inject ReviewViewModel Vm
@inject StubMediaService StubMedia

<h3>Create Review</h3>

<!-- Media ID -->
<div>
    <label>MediaId:</label>
    <input type="number" @bind="Vm.MediaId" />
    <button @onclick="LoadStub">Load</button>
</div>

<!-- VIS STUB MEDIE -->
@if (LoadedMedia != null)
{
    <img src="@LoadedMedia.ImageUrl"
         style="width:150px;height:auto;border-radius:6px;" />
    <p><strong>@LoadedMedia.Title</strong></p>
    <p>@LoadedMedia.Genre</p>
    <p>@LoadedMedia.PublishDate?.Year</p>
    <p>@LoadedMedia.Description</p>
}
else
{
    <p>Indtast MediaId og tryk Load.</p>
}

<!-- Rating -->
<div>
    <label>Rating:</label>
    <select @bind="Vm.Rating">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>
</div>

<!-- Description -->
<div>
    <label>Comment:</label><br />
    <textarea rows="5" cols="40" @bind="Vm.Description"></textarea>
</div>

<button @onclick="Submit">Submit</button>

@if (!string.IsNullOrEmpty(Message))
{
    <p>@Message</p>
}

@code {
    private MediaModel? LoadedMedia;
    private string? Message;

    void LoadStub()
    {
        LoadedMedia = StubMedia.GetStubMedia(Vm.MediaId);
        Message = LoadedMedia == null
            ? "Ingen stub fundet"
            : null;
    }

    private async Task Submit()
    {
        Message = null;

        if (Vm.MediaId <= 0)
        {
            Message = "Ugyldigt MediaId!";
            return;
        }

        if (Vm.Rating < 1 || Vm.Rating > 5)
        {
            Message = "Vælg rating 1-5!";
            return;
        }

        try
        {
            var id = await Vm.CreateReviewAsync();
            Message = $"Review oprettet med ID: {id}";
        }
        catch (Exception ex)
        {
            Message = "Fejl: " + ex.Message;
        }
    }
}